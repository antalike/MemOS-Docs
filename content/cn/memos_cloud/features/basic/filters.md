---
title: 记忆过滤器
desc: 检索记忆时使用记忆过滤器，可以按照指定智能体、元信息、时间范围等条件进行过滤。
---

## 1. 何时使用记忆过滤器

在处理大规模的记忆时，你需要精确控制可以被检索的记忆范围。记忆过滤器（Filter）提供了对检索范围的精细控制能力，主要包括：

*   **指定智能体过滤记忆**：在同一用户的多智能体记忆中，筛选出属于指定智能体的记忆。
    
*   **基于时间检索记忆**：通过时间戳限定检索范围，如查询某天或某个时间段内的记忆。
    
*   **指定自定义范围的记忆**：根据元信息自定义字段，仅检索符合业务条件的记忆。
    

## 2. 过滤器结构说明

支持使用 JSON 格式定义记忆过滤器，可以在最外层使用逻辑运算符来组合多个过滤条件。

```json
# 基础结构如下所示
{
    "AND": [  # 或者"OR"
        { "字段名": "值" },
        { "字段名": { "操作符": "值" } }
    ]
}
```

## 3. 可用字段与运算符

### 3.1 实例字段

| 字段名 | 操作符 | 示例 |
| --- | --- | --- |
| agent\_id | `=` | `{"agent_id":"agent_123"}` |
| app\_id | `=` | `{"app_id":"app_123"}` |

### 3.2 元信息字段

添加消息时，可以传入自定义的元信息字段`info`。目前记忆过滤器支持对以下四个字段进行过滤。

| 字段名 | 操作符 | 示例 |
| --- | --- | --- |
| business\_type | `=` | `{"business_type":"购物"}` |
| biz\_id | `=` | `{"biz_id":"order_123456"}` |
| scene | `=` | `{"scene": "支付"}` |
| custom\_status | `=` | `{"custom_status": "VIP3"}` |

### 3.3 标签字段

| 字段名 | 操作符 | 示例 |
| --- | --- | --- |
| tags | `=`,`contains` | `{"tags": {"contains": "finance"}` |

### 3.4 时间字段

| 字段名 | 操作符 | 示例 |
| --- | --- | --- |
| create\_time | `=`,`>`,`≧`,`<`,`≦` | `{"create_time": {"gte": "2025-12-10"}}` |
| update\_time | `=`,`>`,`≧`,`<`,`≦` | `{"update_time": {"lt": "2025-12-10"}}` |

## 4. 使用示例

::note
**提示**<br> 根节点必须是`and`或`or`，并且组合一系列条件，不允许嵌套逻辑运算符；<br>
不支持在`filter`中指定`user_id`，MemOS按照用户维度检索记忆。
::

使用以下记忆过滤器可满足常见的检索需求，无需重新构建过滤逻辑。

---

**智能体**

```json
# 检索与以下任意智能体相关的记忆
"filters" : {
    "or": [
        {"agent_id": "agent_123"},
        {"agent_id": "agent_456"}
    ]
}
```

**元信息**

```json
# 检索自定义元信息info中的属性
"filters" : {
    "and": [
        {"business_type":"旅行"}, # 宏观业务类别
        {"biz_id":"travel_001"}, # 核心业务标识符
        {"scene":"支付"}, # 消息发生的具体环境或交互环节
        {"custom_status":"v1"} # 自定义状态/标记
    ]
}
```

**标签**

```json
## 检索包含指定标签的记忆
"filters" : {
    "and": [
        {"tags":"天气"}
    ]
}
```

**日期范围**

```json
# 检索2025年12月的记忆
"filters" : {
    "and": [
        {"create_time": {"gt": "2025-12-01"}},
        {"create_time": {"lt": "2026-01-01"}}
    ]
}

# 检索最近一段时间更新的记忆
"filters" : {
    "and": [
        {"update_time": {"gt": "2025-12-10"}}
    ]
}
```

**多维度**

```json
# 检索某用户在Q4与客服助手关于账单的记忆
"filters" : {
    "and": [
        {"agent_id": "customer_service"},
        {"scene":"账单"},
        {"create_time": {"gt": "2025-10-01"}},
        {"create_time": {"lt": "2026-01-01"}}
    ]
}
```
